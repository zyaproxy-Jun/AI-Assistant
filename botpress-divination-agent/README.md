# Ether AI Assistant - å¯¹è¯ä¸å¯¼è´­æ™ºèƒ½ä½“

## é¡¹ç›®æ¦‚è¿°

åŸºäº Botpress æ„å»ºçš„æ™ºèƒ½å åœå¯¼è´­åŠ©æ‰‹ï¼Œé›†æˆ MCP Server çš„ API ä»¥æä¾›å¤šç§å åœæœåŠ¡å¹¶æ¨èç›¸å…³å•†å“ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### æµç¨‹ 1: æ·±åº¦å¯¹è¯ä¸å åœ
- ğŸ¤– **å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ**: ç”¨æˆ·å¯é€‰æ‹©ä¸åŒçš„å åœæ™ºèƒ½ä½“
- ğŸ”® **å…­å¤§å åœæ–¹å¼**:
  - Dream (è§£æ¢¦ - SomniumSage)
  - Tarot (å¡”ç½—ç‰Œ)
  - I-Ching (æ˜“ç»)
  - Ziwei (ç´«å¾®æ–—æ•°)
  - BaZi (å…«å­—)
  - Astrology (è¥¿æ–¹å æ˜Ÿ)
- ğŸ’¬ **æ·±åº¦æ²Ÿé€š**: å¤šè½®å¯¹è¯æ”¶é›†ç”¨æˆ·ä¿¡æ¯
- ğŸ¨ **å¤šæ¨¡æ€è¾“å‡º**: æ–‡æœ¬ + å›¾åƒå±•ç¤ºå åœç»“æœ

### æµç¨‹ 2: æ™ºèƒ½å•†å“æ¨è
- ğŸ›ï¸ **åŸºäºå åœç»“æœçš„å•†å“åŒ¹é…**
- ğŸ“¦ **å•†å“ç±»å‹**:
  - å®ç‰©å•†å“ (æ°´æ™¶ã€å¡”ç½—ç‰Œã€é£æ°´æ‘†ä»¶ç­‰)
  - æ•°å­—å•†å“ (å®šåˆ¶å åœæŠ¥å‘Šã€è§†é¢‘è¯¾ç¨‹ç­‰)
- ğŸ–¼ï¸ **å¤šæ¨¡æ€å•†å“å±•ç¤º**: å›¾ç‰‡ + è¯¦ç»†ä¿¡æ¯
- ğŸ’¡ **æ™ºèƒ½æ¨èå¼•æ“**: æ ¹æ®å åœç»“æœåŒ¹é…æœ€åˆé€‚çš„å•†å“

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç”¨æˆ·å‰ç«¯ç•Œé¢ (Web/Mobile)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Botpress æ™ºèƒ½ä½“å¼•æ“                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¯¹è¯æµç®¡ç† (Conversation Flows)      â”‚   â”‚
â”‚  â”‚  - æ™ºèƒ½ä½“é€‰æ‹©                          â”‚   â”‚
â”‚  â”‚  - ä¿¡æ¯æ”¶é›†                            â”‚   â”‚
â”‚  â”‚  - ç»“æœå±•ç¤º                            â”‚   â”‚
â”‚  â”‚  - å•†å“æ¨è                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        é›†æˆå±‚ (Integration Layer)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MCP Server API â”‚  â”‚  å•†å“æ•°æ®åº“ API   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            æ•°æ®æœåŠ¡å±‚                         â”‚
â”‚  - Divination MCP Server (å åœæœåŠ¡)         â”‚
â”‚  - Product Database (å•†å“æ•°æ®åº“)             â”‚
â”‚  - Image Generation Service (å›¾åƒç”Ÿæˆ)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é¡¹ç›®ç»“æ„

```
botpress-divination-agent/
â”œâ”€â”€ README.md                          # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ package.json                       # ä¾èµ–é…ç½®
â”œâ”€â”€ botpress.config.ts                 # Botpress é…ç½®
â”œâ”€â”€ integration.definition.ts          # é›†æˆå®šä¹‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                       # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ actions/                       # è‡ªå®šä¹‰åŠ¨ä½œ
â”‚   â”‚   â”œâ”€â”€ divination.ts              # å åœç›¸å…³åŠ¨ä½œ
â”‚   â”‚   â”œâ”€â”€ product.ts                 # å•†å“æ¨èåŠ¨ä½œ
â”‚   â”‚   â””â”€â”€ multimodal.ts              # å¤šæ¨¡æ€å¤„ç†
â”‚   â”œâ”€â”€ flows/                         # å¯¹è¯æµ
â”‚   â”‚   â”œâ”€â”€ welcome.json               # æ¬¢è¿æµç¨‹
â”‚   â”‚   â”œâ”€â”€ agent-selection.json       # æ™ºèƒ½ä½“é€‰æ‹©
â”‚   â”‚   â”œâ”€â”€ dream-divination.json      # è§£æ¢¦æµç¨‹
â”‚   â”‚   â”œâ”€â”€ tarot-divination.json      # å¡”ç½—æµç¨‹
â”‚   â”‚   â”œâ”€â”€ iching-divination.json     # æ˜“ç»æµç¨‹
â”‚   â”‚   â”œâ”€â”€ ziwei-divination.json      # ç´«å¾®æµç¨‹
â”‚   â”‚   â”œâ”€â”€ bazi-divination.json       # å…«å­—æµç¨‹
â”‚   â”‚   â”œâ”€â”€ astrology-divination.json  # å æ˜Ÿæµç¨‹
â”‚   â”‚   â””â”€â”€ product-recommendation.json # å•†å“æ¨èæµç¨‹
â”‚   â”œâ”€â”€ services/                      # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ mcp-client.ts              # MCP Server å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ product-matcher.ts         # å•†å“åŒ¹é…å¼•æ“
â”‚   â”‚   â””â”€â”€ image-handler.ts           # å›¾åƒå¤„ç†
â”‚   â”œâ”€â”€ types/                         # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ divination.ts              # å åœç±»å‹
â”‚   â”‚   â””â”€â”€ product.ts                 # å•†å“ç±»å‹
â”‚   â””â”€â”€ utils/                         # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ formatters.ts              # æ ¼å¼åŒ–å·¥å…·
â”‚       â””â”€â”€ validators.ts              # éªŒè¯å·¥å…·
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ products.json                  # å•†å“æ•°æ®
â”‚   â””â”€â”€ matching-rules.json            # åŒ¹é…è§„åˆ™
â””â”€â”€ assets/
    â”œâ”€â”€ images/                        # å›¾ç‰‡èµ„æº
    â””â”€â”€ templates/                     # æ¨¡æ¿æ–‡ä»¶
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd botpress-divination-agent
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:

```env
# MCP Server é…ç½®
MCP_SERVER_URL=http://localhost:3000
MCP_SERVER_API_KEY=your_api_key_here

# Botpress é…ç½®
BOTPRESS_WORKSPACE_ID=your_workspace_id
BOTPRESS_BOT_ID=your_bot_id

# å•†å“æ•°æ®åº“é…ç½®
PRODUCT_DB_URL=your_database_url
PRODUCT_DB_API_KEY=your_db_api_key

# å›¾åƒæœåŠ¡é…ç½® (å¯é€‰)
IMAGE_SERVICE_URL=your_image_service_url
IMAGE_SERVICE_API_KEY=your_image_api_key
```

### 3. å¯åŠ¨ MCP Server

```bash
cd ../divination-mcp-server
node api-server.js
```

### 4. éƒ¨ç½² Botpress é›†æˆ

```bash
cd ../botpress-divination-agent
bp deploy
```

### 5. æµ‹è¯•æ™ºèƒ½ä½“

è®¿é—® Botpress Studio æˆ–ä½¿ç”¨ CLI æµ‹è¯•:

```bash
bp chat
```

## ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·äº¤äº’æµç¨‹

1. **æ¬¢è¿ç•Œé¢**: ç”¨æˆ·è¿›å…¥èŠå¤©ï¼Œçœ‹åˆ°æ™ºèƒ½ä½“ä»‹ç»
2. **é€‰æ‹©æ™ºèƒ½ä½“**: ç”¨æˆ·é€‰æ‹©å åœç±»å‹ï¼ˆè§£æ¢¦ã€å¡”ç½—ã€æ˜“ç»ç­‰ï¼‰
3. **ä¿¡æ¯æ”¶é›†**: æ™ºèƒ½ä½“é€šè¿‡å¤šè½®å¯¹è¯æ”¶é›†å¿…è¦ä¿¡æ¯
4. **å åœæ‰§è¡Œ**: è°ƒç”¨ MCP Server API æ‰§è¡Œå åœ
5. **ç»“æœå±•ç¤º**: ä»¥å¤šæ¨¡æ€å½¢å¼å±•ç¤ºå åœç»“æœï¼ˆæ–‡å­— + å›¾åƒï¼‰
6. **å•†å“æ¨è**: åŸºäºå åœç»“æœæ™ºèƒ½æ¨èç›¸å…³å•†å“
7. **æ·±åº¦å’¨è¯¢**: ç”¨æˆ·å¯ç»§ç»­è¯¢é—®æˆ–é€‰æ‹©å…¶ä»–å åœæ–¹å¼

### ç¤ºä¾‹å¯¹è¯

```
æ™ºèƒ½ä½“: ğŸŒŸ æ¬¢è¿æ¥åˆ° Ether AI Assistantï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±å åœå¯¼è´­åŠ©æ‰‹ã€‚

æ™ºèƒ½ä½“: æˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›ä»¥ä¸‹å åœæœåŠ¡ï¼š
1. ğŸŒ™ è§£æ¢¦ (Dream)
2. ğŸƒ å¡”ç½—ç‰Œ (Tarot)
3. ğŸ“¿ æ˜“ç» (I-Ching)
4. â­ ç´«å¾®æ–—æ•° (Ziwei)
5. ğŸ‹ å…«å­— (BaZi)
6. ğŸŒŒ è¥¿æ–¹å æ˜Ÿ (Astrology)

è¯·é€‰æ‹©æ‚¨æ„Ÿå…´è¶£çš„å åœæ–¹å¼ï¼Œæˆ–å‘Šè¯‰æˆ‘æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Ÿ

ç”¨æˆ·: æˆ‘æƒ³è§£ä¸ªæ¢¦

æ™ºèƒ½ä½“: ğŸŒ™ å¥½çš„ï¼è¯·å‘Šè¯‰æˆ‘æ‚¨æ¢¦åˆ°äº†ä»€ä¹ˆï¼Ÿè¯·å°½å¯èƒ½è¯¦ç»†åœ°æè¿°æ‚¨çš„æ¢¦å¢ƒã€‚

ç”¨æˆ·: æˆ‘æ¢¦è§è‡ªå·±åœ¨å¤©ä¸Šé£

æ™ºèƒ½ä½“: âœ¨ æ”¶åˆ°ï¼è®©æˆ‘ä¸ºæ‚¨è§£æè¿™ä¸ªæ¢¦å¢ƒ...

[è°ƒç”¨ MCP Server Dream API]

æ™ºèƒ½ä½“: ğŸ“Š è§£æ¢¦ç»“æœï¼š

ğŸ­ æƒ…æ„Ÿåˆ†æ:
   åŸºè°ƒ: POSITIVE
   ç½®ä¿¡åº¦: 90.0%
   æè¿°: æ‚¨çš„æ¢¦å¢ƒä¼ é€’ç€ç§¯æã€å‘ä¸Šçš„ä¿¡æ¯

ğŸ”® è¯†åˆ«ç¬¦å·: 1 ä¸ª
   â€¢ é£: è‡ªç”±ã€è¶…è¶Šã€çµæ€§è¿½æ±‚ã€æ‘†è„±æŸç¼š

ğŸ“– è§£æå†…å®¹:
æ‚¨çš„æ¢¦å¢ƒè±¡å¾ç€å¯¹è‡ªç”±çš„å‘å¾€å’Œå¯¹ç°å®æŸç¼šçš„è¶…è¶Š...

[æ˜¾ç¤ºç›¸å…³å›¾åƒ]

æ™ºèƒ½ä½“: ğŸ’¡ æ ¹æ®æ‚¨çš„æ¢¦å¢ƒè§£æï¼Œæˆ‘ä¸ºæ‚¨æ¨èä»¥ä¸‹å•†å“ï¼š

ğŸ›ï¸ æ¨èå•†å“ 1: å¤©ç©ºè“æ°´æ™¶æ‰‹é“¾
   - å¯“æ„: æå‡çµæ€§ï¼ŒåŠ©æ‚¨è¿½æ±‚è‡ªç”±
   - ä»·æ ¼: Â¥299
   - [æŸ¥çœ‹è¯¦æƒ…]

ğŸ›ï¸ æ¨èå•†å“ 2: ã€Šæ¢¦å¢ƒè§£æå®Œæ•´æŒ‡å—ã€‹ç”µå­ä¹¦
   - å†…å®¹: æ·±åº¦è§£è¯»é£ç¿”æ¢¦å¢ƒçš„å¿ƒç†å­¦å«ä¹‰
   - ä»·æ ¼: Â¥49
   - [ç«‹å³è´­ä¹°]

æ™ºèƒ½ä½“: æ‚¨å¯¹è¿™äº›å•†å“æ„Ÿå…´è¶£å—ï¼Ÿæˆ–è€…æƒ³äº†è§£æ›´å¤šå…³äºæ‚¨æ¢¦å¢ƒçš„ä¿¡æ¯ï¼Ÿ
```

## API é›†æˆ

### MCP Server ç«¯ç‚¹

æ‰€æœ‰å åœ API éƒ½é€šè¿‡ `http://localhost:3000` è®¿é—®:

- POST `/divination/dream` - è§£æ¢¦
- POST `/divination/tarot` - å¡”ç½—ç‰Œ
- POST `/divination/iching` - æ˜“ç»
- POST `/divination/ziwei` - ç´«å¾®æ–—æ•°
- POST `/divination/bazi` - å…«å­—
- POST `/divination/astrology` - è¥¿æ–¹å æ˜Ÿ

### è¯·æ±‚ç¤ºä¾‹

```javascript
// è§£æ¢¦è¯·æ±‚
const response = await fetch('http://localhost:3000/divination/dream', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    dream_description: "æˆ‘æ¢¦è§è‡ªå·±åœ¨å¤©ä¸Šé£",
    language: "zh-CN",
    emotions: ["excited", "free"]
  })
});

const result = await response.json();
```

## å•†å“åŒ¹é…è§„åˆ™

å•†å“æ¨èåŸºäºä»¥ä¸‹ç»´åº¦åŒ¹é…ï¼š

1. **å åœç±»å‹**: ä¸åŒå åœæ–¹å¼æ¨èä¸åŒç±»åˆ«å•†å“
2. **æƒ…æ„ŸåŸºè°ƒ**: POSITIVE/NEGATIVE/NEUTRAL å½±å“å•†å“é€‰æ‹©
3. **å…³é”®ç¬¦å·**: ç‰¹å®šç¬¦å·åŒ¹é…ç‰¹å®šå•†å“
4. **ç”¨æˆ·ç”»åƒ**: ç»“åˆå†å²äº’åŠ¨æ•°æ®ä¸ªæ€§åŒ–æ¨è

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„å åœæ–¹å¼

1. åœ¨ `src/flows/` åˆ›å»ºæ–°çš„å¯¹è¯æµ JSON
2. åœ¨ `src/actions/divination.ts` æ·»åŠ å¯¹åº”çš„åŠ¨ä½œ
3. åœ¨ `data/matching-rules.json` é…ç½®å•†å“åŒ¹é…è§„åˆ™
4. æ›´æ–° `src/flows/agent-selection.json` æ·»åŠ é€‰é¡¹

### æ·»åŠ æ–°å•†å“

åœ¨ `data/products.json` æ·»åŠ å•†å“æ•°æ®:

```json
{
  "id": "product_001",
  "name": "å¤©ç©ºè“æ°´æ™¶æ‰‹é“¾",
  "type": "physical",
  "category": "crystal",
  "price": 299,
  "currency": "CNY",
  "description": "æå‡çµæ€§ï¼ŒåŠ©æ‚¨è¿½æ±‚è‡ªç”±",
  "images": [
    "/assets/images/products/crystal_001.jpg"
  ],
  "tags": ["freedom", "spiritual", "positive"],
  "matchingRules": {
    "divinationTypes": ["dream"],
    "keywords": ["é£", "è‡ªç”±", "ç¿±ç¿”"],
    "sentiment": ["POSITIVE"]
  }
}
```

## å¤šæ¨¡æ€æ”¯æŒ

### å›¾åƒå±•ç¤º

æ™ºèƒ½ä½“æ”¯æŒåœ¨å¯¹è¯ä¸­åµŒå…¥å›¾åƒ:

```typescript
// åœ¨ action ä¸­å‘é€å›¾åƒ
await bp.createMessage({
  conversationId,
  userId,
  type: 'image',
  payload: {
    imageUrl: 'https://example.com/image.jpg',
    title: 'å åœç»“æœå¯è§†åŒ–'
  }
});
```

### å¯Œæ–‡æœ¬å¡ç‰‡

ä½¿ç”¨ Botpress çš„å¡ç‰‡ç»„ä»¶å±•ç¤ºå•†å“:

```typescript
await bp.createMessage({
  conversationId,
  userId,
  type: 'card',
  payload: {
    title: product.name,
    subtitle: product.description,
    imageUrl: product.images[0],
    actions: [
      {
        label: 'æŸ¥çœ‹è¯¦æƒ…',
        action: 'postback',
        value: `view_product_${product.id}`
      },
      {
        label: 'ç«‹å³è´­ä¹°',
        action: 'postback',
        value: `buy_product_${product.id}`
      }
    ]
  }
});
```

## æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶:

```bash
npm test
```

æµ‹è¯•å•ä¸ªå åœæµç¨‹:

```bash
npm run test:dream
npm run test:tarot
```

## éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ

```bash
bp deploy
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
bp deploy --public
```

## æ•…éšœæ’é™¤

### MCP Server è¿æ¥å¤±è´¥

1. ç¡®è®¤ MCP Server æ­£åœ¨è¿è¡Œ: `http://localhost:3000`
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. éªŒè¯ API å¯†é’¥é…ç½®

### å•†å“æ¨èä¸å‡†ç¡®

1. æ£€æŸ¥ `data/matching-rules.json` é…ç½®
2. å®¡æŸ¥å åœç»“æœçš„å…³é”®å­—æå–
3. è°ƒæ•´åŒ¹é…ç®—æ³•æƒé‡

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: https://github.com/zyaproxy-Jun/AI-Assistant
- é—®é¢˜åé¦ˆ: https://github.com/zyaproxy-Jun/AI-Assistant/issues
