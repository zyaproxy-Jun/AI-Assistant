# 紫微斗数测试指南

## 🎯 快速测试

### 方法1: 单次测试（推荐）
测试特定时辰的紫微命盘生成：

```bash
# 测试16时（下午4点，申时）
node test-ziwei.js

# 测试14时（下午2点，未时）
node test-ziwei-14.js
```

### 方法2: 多时辰测试
一次性测试多个时辰，验证时辰转换功能：

```bash
node test-multiple-hours.js
```

测试覆盖：
- ✅ 0时 - 子时（午夜）
- ✅ 6时 - 卯时（早晨）
- ✅ 12时 - 午时（正午）- 边界情况
- ✅ 14时 - 未时（下午）- 13-23时转换
- ✅ 16时 - 申时（下午）
- ✅ 20时 - 戌时（晚上）
- ✅ 23时 - 子时（深夜）

### 方法3: 网页测试界面
启动网页服务器，通过浏览器查看：

```bash
node web-server.js
```

然后访问: http://localhost:3000

⚠️ **注意**: 网页界面是**演示用途**，实际占卜需要通过 MCP 协议调用。

## 📊 测试结果示例

### 成功的测试输出

```
======================================================================
⭐ 紫微斗数测试 - Zi Wei Dou Shu Test
======================================================================

✅ 服务器连接成功

📋 测试参数：
{
  "solar_date": "2000-01-01",
  "birth_hour": 16,
  "gender": "男",
  "language": "zh-CN"
}

🔮 正在生成紫微命盘...

✅ 命盘生成成功！
⏱️  耗时: 109ms

======================================================================
📊 紫微命盘结果：
======================================================================

👤 基本信息：
----------------------------------------------------------------------
  出生日期: 2000-01-01
  出生时辰: 16时 (申时 (15-17时))
  性别: 男
  农历: 一九九九年冬月廿五

🌟 命盘信息：
  阳历: 2000-01-01
  农历: 一九九九年冬月廿五
  干支: 己卯 丙子 戊午 丙辰
  生肖: 兔
  星座: 摩羯座

命理：
  命主: 廉贞
  身主: 天同
  命宫地支: 申
  身宫地支: 辰
  五行局: 金四局
```

## 🔧 自定义测试参数

### 修改测试参数
编辑 `test-ziwei.js` 中的 `testParams` 对象：

```javascript
const testParams = {
  solar_date: '2000-01-01',  // 阳历日期 (YYYY-MM-DD)
  birth_hour: 16,            // 出生时辰 (0-23)
  gender: '男',              // 性别: '男' 或 '女'
  language: 'zh-CN'          // 语言: 'zh-CN', 'zh-TW', 'en-US', 'ja-JP', 'ko-KR'
};
```

### 支持的参数

#### solar_date (阳历日期)
- **格式**: `YYYY-MM-DD`
- **示例**: `'2000-01-01'`, `'1990-05-15'`, `'2024-12-31'`
- **范围**: 1900-2100

#### birth_hour (出生时辰)
- **格式**: 数字（0-23）
- **说明**: 使用标准24小时制
- **自动转换**: 
  - 0-12时：直接使用
  - 13-23时：自动转换为下午时辰
  - 12时：特殊处理为午时

**时辰对照表**:
| 24小时 | 传统时辰 | 时间范围 | 24小时 | 传统时辰 | 时间范围 |
|--------|---------|---------|--------|---------|---------|
| 0时 | 子时 | 23-01时 | 13时 | 未时 | 13-15时 |
| 1-2时 | 丑时 | 01-03时 | 14时 | 未时 | 13-15时 |
| 3-4时 | 寅时 | 03-05时 | 15-16时 | 申时 | 15-17时 |
| 5-6时 | 卯时 | 05-07时 | 17-18时 | 酉时 | 17-19时 |
| 7-8时 | 辰时 | 07-09时 | 19-20时 | 戌时 | 19-21时 |
| 9-10时 | 巳时 | 09-11时 | 21-22时 | 亥时 | 21-23时 |
| 11-12时 | 午时 | 11-13时 | 23时 | 子时 | 23-01时 |

#### gender (性别)
- **值**: `'男'` 或 `'女'`
- **说明**: 影响命盘排列方式

#### language (语言)
- **支持的语言**:
  - `'zh-CN'` - 简体中文（默认）
  - `'zh-TW'` - 繁体中文
  - `'en-US'` - 英文
  - `'ja-JP'` - 日文
  - `'ko-KR'` - 韩文

## 🐛 故障排除

### 问题1: "wrong hour X" 错误

**症状**: 
```
Error: wrong hour 31
```

**原因**: 时辰参数超出 iztro 库支持的范围

**解决**: 
✅ 此问题已修复！服务会自动将24小时制转换为12小时制。
如果仍然遇到此问题，请确保：
1. 已重新编译: `npm run build`
2. 使用的是最新代码

### 问题2: 服务器连接失败

**症状**:
```
❌ 无法连接到服务器
```

**解决**:
1. 确保已安装依赖: `npm install`
2. 确保已编译代码: `npm run build`
3. 检查 `dist/index.js` 文件是否存在

### 问题3: 命盘数据不完整

**症状**: 缺少宫位或星曜信息

**解决**:
1. 检查输入参数是否正确
2. 确保日期在有效范围内（1900-2100）
3. 验证 iztro 库版本: `npm list iztro`

### 问题4: 性能慢

**症状**: 生成命盘耗时超过500ms

**可能原因**:
- 首次运行（需要加载库）
- 系统资源不足
- Node.js 版本过低

**建议**:
- 使用 Node.js 16+
- 正常耗时: 80-150ms

## 📚 相关文档

- **ZIWEI_HOUR_FIX.md** - 时辰格式修复详细说明
- **ZIWEI_TEST_COMPLETION_REPORT.md** - 完整测试报告
- **WEB_TESTING_GUIDE.md** - 网页测试指南
- **README.md** - 项目主文档

## 🔗 工具名称参考

在 MCP 协议中调用时，使用以下工具名称：

```json
{
  "tool": "ziwei_chart",
  "arguments": {
    "solar_date": "2000-01-01",
    "birth_hour": 16,
    "gender": "男",
    "language": "zh-CN"
  }
}
```

⚠️ **注意**: 工具名称是 `ziwei_chart`（下划线），不是 `generate-ziwei-chart`。

## ✅ 验证清单

测试前确认：
- [ ] 已安装依赖 (`npm install`)
- [ ] 已编译代码 (`npm run build`)
- [ ] `dist/index.js` 存在
- [ ] Node.js 版本 >= 16

测试后验证：
- [ ] 测试通过（显示 ✅）
- [ ] 命盘数据完整
- [ ] 时辰转换正确
- [ ] 响应时间合理（< 200ms）

## 🎉 成功标准

一个成功的测试应该：
1. ✅ 服务器连接成功
2. ✅ 命盘生成成功
3. ✅ 包含基本信息（日期、性别、农历）
4. ✅ 包含命理信息（命主、身主、五行局）
5. ✅ 包含12个宫位数据
6. ✅ 响应时间在 200ms 以内
7. ✅ 无错误或警告

## 📞 获取帮助

如果遇到问题：
1. 查看测试输出中的错误信息
2. 阅读相关文档（ZIWEI_HOUR_FIX.md）
3. 检查 GitHub Issues
4. 联系维护者: zyaproxy@gmail.com

---

**最后更新**: 2024-10-06  
**状态**: ✅ 所有测试通过  
**维护者**: Jun (zyaproxy@gmail.com)
