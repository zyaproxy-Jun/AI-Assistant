# 🔮 前端占卜功能测试指南

## 📋 测试环境状态

✅ **服务器运行状态**：
- **Web Server**: http://localhost:8080 ✅ 运行中
- **API Server**: http://localhost:3000 ✅ 运行中
- **测试页面**: http://localhost:8080/test-interactive.html

---

## 🎯 测试功能清单

### 1. 🃏 塔罗占卜 (Tarot Reading)

**测试步骤**：
1. 点击"塔罗占卜"标签
2. 在"占卜问题"输入框填写问题（或点击"填充示例"）
3. 点击"🔮 开始占卜"按钮
4. 等待结果显示

**预期结果**：
- 显示 3 张塔罗牌（过去、现在、未来）
- 每张牌包含名称、正逆位、牌义解读
- 综合解读和建议

**示例问题**：
- "我的事业发展如何？"
- "我的感情运势怎么样？"
- "我是否应该做出这个决定？"

---

### 2. ⭐ 紫微斗数 (Zi Wei Dou Shu)

**测试步骤**：
1. 点击"紫微斗数"标签
2. 填写出生信息：
   - 出生年份：1990
   - 出生月份：5
   - 出生日期：15
   - 出生时辰：午时 (11:00-13:00)
   - 性别：男/女
3. 点击"⭐ 开始排盘"按钮

**预期结果**：
- 命盘十二宫位信息
- 主星分布
- 命宫、身宫详细解析
- 性格特点和运势分析

**参数格式**：
```javascript
{
  solar_date: "1990-05-15",
  birth_hour: 14,
  gender: "male"  // 或 "female"
}
```

---

### 3. 🌌 西洋占星 (Birth Chart)

**测试步骤**：
1. 点击"西洋占星"标签
2. 填写出生信息：
   - 出生年份：1990
   - 出生月份：5
   - 出生日期：15
   - 出生时：14
   - 出生分：30
   - 出生地纬度：39.9042（北京）
   - 出生地经度：116.4074（北京）
3. 点击"🌌 生成星盘"按钮

**预期结果**：
- 太阳、月亮、上升星座信息
- 十二宫位详细解析
- 行星位置和相位
- 性格特征和人生主题

**常用城市坐标**：
- 北京：纬度 39.9042，经度 116.4074
- 上海：纬度 31.2304，经度 121.4737
- 广州：纬度 23.1291，经度 113.2644

---

### 4. 💭 梦境解析 (Dream Interpretation)

**测试步骤**：
1. 点击"梦境解析"标签
2. 在"梦境描述"文本框详细描述梦境
3. 点击"💭 解析梦境"按钮

**预期结果**：
- 梦境主题分析
- 心理学角度解读
- 象征意义说明
- 潜意识信息提示

**示例梦境**：
- "我梦见自己在飞翔，飞过高山和海洋，感觉很自由。"
- "我梦见迷路了，找不到回家的路。"
- "我梦见和很久不见的朋友重逢。"

---

### 5. 🎋 八字命理 (Ba Zi Analysis)

**测试步骤**：
1. 点击"八字命理"标签
2. 填写出生信息：
   - 出生年份：1990
   - 出生月份：5
   - 出生日期：15
   - 出生时：14（24小时制）
   - 性别：男/女
3. 点击"🎋 排八字"按钮

**预期结果**：
- 四柱八字（年柱、月柱、日柱、时柱）
- 五行分析
- 十神关系
- 大运流年
- 性格和运势分析

**参数格式**：
```javascript
{
  solar_date: "1990-05-15",
  birth_hour: 14,
  gender: "male"  // 或 "female"
}
```

---

### 6. ☯️ 易经占卜 (I Ching Divination)

**测试步骤**：
1. 点击"易经占卜"标签
2. 输入占卜问题
3. 选择卜卦方法：
   - 时间起卦（默认）
   - 铜钱卦
   - 数字起卦
4. 点击"☯️ 开始卜卦"按钮

**预期结果**：
- 本卦卦象（64卦之一）
- 卦名、卦辞
- 爻辞解析
- 变卦信息（如有）
- 占卜建议

**示例问题**：
- "我是否应该换工作？"
- "这次投资是否合适？"
- "我与某人的关系如何发展？"

**方法说明**：
- `时间起卦` → API: `coins`
- `铜钱卦` → API: `coins`
- `数字起卦` → API: `random`

---

## 🔧 故障排查

### 问题 1: "❌ 错误: 调用失败"
**解决方案**：
1. 检查 API Server 是否运行（访问 http://localhost:3000/health）
2. 查看控制台错误信息
3. 确认参数格式正确

### 问题 2: "ERR_CONNECTION_REFUSED"
**解决方案**：
1. 重启 Web Server：`node web-server.js`
2. 检查端口 8080 是否被占用
3. 使用 `Get-NetTCPConnection -LocalPort 8080` 检查端口状态

### 问题 3: 工具名称错误
**正确的工具名称**：
- ✅ `tarot_reading` (塔罗占卜)
- ✅ `ziwei_chart` (紫微斗数)
- ✅ `birth_chart` (西洋占星)
- ✅ `interpret_dream` (梦境解析)
- ✅ `bazi_analysis` (八字命理)
- ✅ `iching_divination` (易经占卜)

---

## 📊 测试检查表

使用此检查表记录测试结果：

- [ ] **塔罗占卜** - 成功显示 3 张牌和解读
- [ ] **紫微斗数** - 成功生成命盘和分析
- [ ] **西洋占星** - 成功生成星盘和解读
- [ ] **梦境解析** - 成功分析梦境含义
- [ ] **八字命理** - 成功排出四柱八字
- [ ] **易经占卜** - 成功生成卦象和解析

---

## 🎨 界面功能

### 填充示例按钮
每个占卜系统都有"填充示例"按钮，可快速填充测试数据：
- 塔罗占卜：示例问题
- 紫微斗数：1990-05-15 午时 男
- 西洋占星：1990-05-15 14:30 北京
- 梦境解析：飞翔梦境
- 八字命理：1990-05-15 14:00 男
- 易经占卜：换工作问题

### 加载动画
提交后会显示旋转的加载动画和提示文字。

### 结果展示
结果显示在灰色背景的卡片中，支持滚动查看长内容。

---

## 💡 使用技巧

1. **使用填充示例快速测试**：每个标签页都有"填充示例"按钮
2. **保持服务器运行**：两个服务器必须同时运行
3. **查看控制台**：F12 打开开发者工具查看详细错误
4. **重新加载页面**：Ctrl+R 刷新页面重新开始

---

## 📝 API 端点

所有占卜功能通过统一端点调用：

```
POST http://localhost:3000/api/divination
Content-Type: application/json

{
  "tool": "工具名称",
  "args": {
    // 工具参数
  }
}
```

**响应格式**：
```json
{
  "content": [
    {
      "type": "text",
      "text": "占卜结果内容"
    }
  ],
  "_meta": {
    "responseTime": 123,
    "timestamp": "2025-10-07T..."
  }
}
```

---

## 🚀 启动命令

**启动 Web Server**：
```powershell
node web-server.js
```

**启动 API Server**：
```powershell
node api-server.js
```

**同时启动两个服务器**（推荐）：
```powershell
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'C:\Users\HUAWEI\Desktop\AI-Assistant\divination-mcp-server'; node web-server.js"
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'C:\Users\HUAWEI\Desktop\AI-Assistant\divination-mcp-server'; node api-server.js"
```

---

## ✅ 测试完成

测试完成后请确认：
1. ✅ 所有 6 个占卜系统都能正常返回结果
2. ✅ 参数格式正确，无报错
3. ✅ 结果内容完整，格式清晰
4. ✅ 界面响应流畅，无卡顿

---

**最后更新**: 2025-10-07  
**版本**: v1.0.0  
**测试页面**: http://localhost:8080/test-interactive.html
